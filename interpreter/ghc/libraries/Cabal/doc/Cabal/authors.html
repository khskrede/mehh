<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>3. Creating a package</title><link rel="stylesheet" type="text/css" href="fptools.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="Common Architecture for Building Applications and Libraries"><link rel="up" href="index.html" title="Common Architecture for Building Applications and Libraries"><link rel="prev" href="packages.html" title="2. Packages"><link rel="next" href="builders.html" title="4. Building and installing a package"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. Creating a package</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="packages.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="builders.html">Next</a></td></tr></table><hr></div><div class="sect1" title="3. Creating a package"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="authors"></a>3. Creating a package</h2></div></div></div><p>Suppose you have a directory hierarchy containing the source
      files that make up your package.  You will need to add two more
      files to the root directory of the package:</p><div class="variablelist"><dl><dt><span class="term">
          <code class="filename"><em class="replaceable"><code>package</code></em>.cabal</code>
        </span></dt><dd><p>a Unicode UTF-8 text file containing a package description
            (for details of the syntax of this file, see
            <a class="xref" href="authors.html#pkg-descr" title="3.1. Package descriptions">Section 3.1, &#8220;Package descriptions&#8221;</a>)</p></dd><dt><span class="term">
          <code class="filename">Setup.hs</code> or
          <code class="filename">Setup.lhs</code>
        </span></dt><dd><p>a single-module Haskell program to perform various
            setup tasks (with the interface described in
            <a class="xref" href="builders.html" title="4. Building and installing a package">Section 4, &#8220;Building and installing a package&#8221;</a>).  This module should import only
            modules that will be present in all Haskell implementations,
            including modules of the Cabal library.  In most cases it
            will be trivial, calling on the Cabal library to do most of
            the work.</p></dd></dl></div><p>Once you have these, you can create a source bundle of this
      directory for distribution.  Building of the package is discussed in
      <a class="xref" href="builders.html" title="4. Building and installing a package">Section 4, &#8220;Building and installing a package&#8221;</a>.</p><div class="example"><a name="simple-library-example"></a><p class="title"><b>Example 1. A package containing a simple library</b></p><div class="example-contents"><p>The HUnit package contains a file <code class="filename">HUnit.cabal</code>
        containing:</p><pre class="programlisting">
Name:		HUnit
Version:	1.1.1
Cabal-Version:  &gt;= 1.2
License:	BSD3
License-File:	LICENSE
Author:		Dean Herington
Homepage:	http://hunit.sourceforge.net/
Category:	Testing
Synopsis:	A unit testing framework for Haskell

Library
  Build-Depends:	base
  Exposed-modules:
    Test.HUnit.Base, Test.HUnit.Lang, Test.HUnit.Terminal,
    Test.HUnit.Text, Test.HUnit
  Extensions:	CPP
</pre><p>and the following <code class="filename">Setup.hs</code>:</p><pre class="programlisting">
import Distribution.Simple
main = defaultMain</pre></div></div><br class="example-break"><div class="example"><a name="simple-executable-example"></a><p class="title"><b>Example 2. A package containing executable programs</b></p><div class="example-contents"><pre class="programlisting">
Name:           TestPackage
Version:        0.0
Cabal-Version:  &gt;= 1.2
License:        BSD3
Author:         Angela Author
Synopsis:       Small package with two programs
Build-Type:     Simple

Executable program1
  Build-Depends:  HUnit
  Main-Is:        Main.hs
  Hs-Source-Dirs: prog1

Executable program2
  Main-Is:        Main.hs
  Build-Depends:  HUnit
  Hs-Source-Dirs: prog2
  Other-Modules:  Utils
</pre><p>with <code class="filename">Setup.hs</code> the same as above.</p></div></div><br class="example-break"><div class="example"><a name="simple-library-executable-example"></a><p class="title"><b>Example 3. A package containing a library and executable programs</b></p><div class="example-contents"><pre class="programlisting">
Name:            TestPackage
Version:         0.0
Cabal-Version:   &gt;= 1.2
License:         BSD3
Author:          Angela Author
Synopsis:        Package with library and two programs
Build-Type:      Simple

Library
  Build-Depends:   HUnit
  Exposed-Modules: A, B, C

Executable program1
  Main-Is:         Main.hs
  Hs-Source-Dirs:  prog1
  Other-Modules:   A, B

Executable program2
  Main-Is:         Main.hs
  Hs-Source-Dirs:  prog2
  Other-Modules:   A, C, Utils
</pre><p>with <code class="filename">Setup.hs</code> the same as above.
      Note that any library modules required (directly or indirectly)
      by an executable must be listed again.</p></div></div><br class="example-break"><p>The trivial setup script used in these examples uses
      the <em class="firstterm">simple build infrastructure</em>
      provided by the Cabal library (see <a class="ulink" href="../libraries/Cabal/Distribution-Simple.html" target="_top">Distribution.Simple</a>).
      The simplicity lies in its interface rather that its implementation.
      It automatically handles preprocessing with standard preprocessors,
      and builds packages for all the Haskell implementations (except
      nhc98, for now).</p><p>The simple build infrastructure can also handle packages
      where building is governed by system-dependent parameters,
      if you specify a little more (see <a class="xref" href="authors.html#system-dependent" title="3.3. System-dependent parameters">Section 3.3, &#8220;System-dependent parameters&#8221;</a>).
      A few packages require more elaborate solutions
      (see <a class="xref" href="authors.html#complex-packages" title="3.5. More complex packages">Section 3.5, &#8220;More complex packages&#8221;</a>).</p><div class="sect2" title="3.1. Package descriptions"><div class="titlepage"><div><div><h3 class="title"><a name="pkg-descr"></a>3.1. Package descriptions</h3></div></div></div><p>The package description file must have a name ending in
        <span class="quote">&#8220;<span class="quote"><code class="literal">.cabal</code></span>&#8221;</span>.  It must be a Unicode text
	file encoded using valid UTF-8. There must be exactly
        one such file in the directory.  The first part of the name is
        usually the package name, and some of the tools that operate
        on Cabal packages require this.</p><p>In the package description file, lines whose first
      non-whitespace characters
      are <span class="quote">&#8220;<span class="quote"><code class="literal">--</code></span>&#8221;</span> are treated as comments
      and ignored.</p><p>This file should contain of a number global property
      descriptions and several sections.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The global properties describe the package as a whole,
	  such as name, license, author, etc.  (see <a class="xref" href="authors.html#general-fields" title="3.1.1. Package properties">Section 3.1.1, &#8220;Package properties&#8221;</a>).</p></li><li class="listitem"><p>Optionally, a number of <em class="firstterm">configuration
	  flags</em> can be declared.  These can be used to
	  enable or disable certain features of a package. (see <a class="xref" href="authors.html#configurations" title="3.1.5. Configurations">Section 3.1.5, &#8220;Configurations&#8221;</a>).</p></li><li class="listitem"><p>The (optional) library section specifies the library
	  properties (see <a class="xref" href="authors.html#library" title="3.1.2. Library">Section 3.1.2, &#8220;Library&#8221;</a>) and relevant build
	  information (see <a class="xref" href="authors.html#buildinfo" title="3.1.4. Build information">Section 3.1.4, &#8220;Build information&#8221;</a>).</p></li><li class="listitem"><p>Following is an arbitrary number of executable sections
	  which describe an executable program and (see <a class="xref" href="authors.html#executable" title="3.1.3. Executables">Section 3.1.3, &#8220;Executables&#8221;</a>) relevant build information (see <a class="xref" href="authors.html#buildinfo" title="3.1.4. Build information">Section 3.1.4, &#8220;Build information&#8221;</a>).</p></li></ul></div><p>Each section consists of a number of property descriptions
      in the form of field/value pairs, with a syntax roughly like mail
      message headers.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Case is not significant in field names,
            but is significant in field values.</p></li><li class="listitem"><p>To continue a field value, indent the next line
          relative to the field name.</p></li><li class="listitem"><p>Field names may be indented, but all field values in
          the same section must use the same indentation.</p></li><li class="listitem"><p>Tabs are <span class="emphasis"><em>not</em></span> allowed as
          indentation characters due to a missing standard
          interpretation of tab width.</p></li><li class="listitem"><p>To get a blank line in a field value, use an indented
            <span class="quote">&#8220;<span class="quote"><code class="literal">.</code></span>&#8221;</span></p></li></ul></div><p>The syntax of the value depends on the field.  Field types
        include:</p><div class="variablelist"><dl><dt><span class="term">
            <em class="replaceable"><code>token</code></em>
          , </span><span class="term">
            <em class="replaceable"><code>filename</code></em>
          , </span><span class="term">
            <em class="replaceable"><code>directory</code></em>
          </span></dt><dd><p>Either a sequence of one or more non-space non-comma
              characters, or a quoted string in Haskell 98 lexical syntax.
              Unless otherwise stated, relative filenames and directories
              are interpreted from the package root directory.</p></dd><dt><span class="term">
            <em class="replaceable"><code>freeform</code></em>
          , </span><span class="term">
            <em class="replaceable"><code>URL</code></em>
          , </span><span class="term">
            <em class="replaceable"><code>address</code></em>
          </span></dt><dd><p>An arbitrary, uninterpreted string.</p></dd><dt><span class="term">
            <em class="replaceable"><code>identifier</code></em>
          </span></dt><dd><p>A letter followed by zero or more alphanumerics
              or underscores.</p></dd><dt><span class="term">
	    <em class="replaceable"><code>compiler</code></em>
	  </span></dt><dd><p>A compiler flavor (one
              of: <code class="literal">GHC</code>, <code class="literal">NHC</code>,
	          <code class="literal">YHC</code>, <code class="literal">Hugs</code>,
	          <code class="literal">HBC</code>, <code class="literal">Helium</code>,
                  <code class="literal">JHC</code>, or <code class="literal">LHC</code>)
              followed by a version range.  For example,
              <code class="literal">GHC ==6.10.3</code>,
	      or <code class="literal">LHC &gt;=0.6 &amp;&amp; &lt;0.8</code>.
            </p></dd></dl></div><div class="note" title="Modules and preprocessors" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Modules and preprocessors</h3><p>Haskell module names listed in the
          <code class="literal">exposed-modules</code> and
          <code class="literal">other-modules</code> fields may
          correspond to Haskell source files, i.e. with names
          ending in <span class="quote">&#8220;<span class="quote"><code class="literal">.hs</code></span>&#8221;</span> or
          <span class="quote">&#8220;<span class="quote"><code class="literal">.lhs</code></span>&#8221;</span>, or to inputs for
          various Haskell preprocessors.
          The simple build infrastructure understands the extensions
          <span class="quote">&#8220;<span class="quote"><code class="literal">.gc</code></span>&#8221;</span> (<a class="ulink" href="http://www.haskell.org/greencard/" target="_top"><span class="command"><strong>greencard</strong></span></a>),
          <span class="quote">&#8220;<span class="quote"><code class="literal">.chs</code></span>&#8221;</span> (<a class="ulink" href="http://www.cse.unsw.edu.au/~chak/haskell/c2hs/" target="_top"><span class="command"><strong>c2hs</strong></span></a>),
          <span class="quote">&#8220;<span class="quote"><code class="literal">.hsc</code></span>&#8221;</span> (<span class="command"><strong>hsc2hs</strong></span>),
          <span class="quote">&#8220;<span class="quote"><code class="literal">.y</code></span>&#8221;</span> and
          <span class="quote">&#8220;<span class="quote"><code class="literal">.ly</code></span>&#8221;</span> (<a class="ulink" href="http://www.haskell.org/happy/" target="_top"><span class="command"><strong>happy</strong></span></a>),
          <span class="quote">&#8220;<span class="quote"><code class="literal">.x</code></span>&#8221;</span> (<a class="ulink" href="http://www.haskell.org/alex/" target="_top"><span class="command"><strong>alex</strong></span></a>)
          and
          <span class="quote">&#8220;<span class="quote"><code class="literal">.cpphs</code></span>&#8221;</span> (<a class="ulink" href="http://www.haskell.org/cpphs/" target="_top"><span class="command"><strong>cpphs</strong></span></a>).
          When building, Cabal will automatically run the appropriate
          preprocessor and compile the Haskell module it produces.</p></div><p>Some fields take lists of values, which
        are optionally separated by commas, except for the
        <code class="literal">build-depends</code> field, where the commas are
        mandatory.</p><p>Some fields are marked as required.  All others are optional,
        and unless otherwise specified have empty default values.</p><div class="sect3" title="3.1.1. Package properties"><div class="titlepage"><div><div><h4 class="title"><a name="general-fields"></a>3.1.1. Package properties</h4></div></div></div><p>These fields may occur in the first top-level properties
        section and describe the package as a whole:</p><div class="variablelist"><dl><dt><span class="term">
              <code class="literal">name:</code> <em class="replaceable"><code>package-name</code></em>
              (required)
            </span></dt><dd><p>The unique name of the package
                (see <a class="xref" href="packages.html" title="2. Packages">Section 2, &#8220;Packages&#8221;</a>), without the version
                number.</p></dd><dt><span class="term">
              <code class="literal">version:</code> <em class="replaceable"><code>numbers</code></em>
              (required)
            </span></dt><dd><p>The package version number, usually consisting of a
                sequence of natural numbers separated by dots.</p></dd><dt><span class="term">
              <code class="literal">cabal-version:</code> <em class="replaceable"><code>&gt;, &lt;=, etc. &amp; numbers</code></em>
            </span></dt><dd><p>The version of Cabal required for this package.
              Since, with Cabal version 1.2 the syntax of package
              descriptions has changed, this is now a required field.
              List the field early in your <code class="literal">.cabal</code>
              file so that it will appear as a syntax error before any
              others, since old versions of Cabal unfortunately do not
              recognize this field.</p><p>For compatibility, files written in the old syntax
	      are still recognized.  Thus if you don't require
	      features introduced with or after Cabal version 1.2, you
	      may write your package description file using the old
	      syntax.  Please consult the user's guide of that Cabal
	      version for a description of that syntax.</p></dd><dt><span class="term">
              <code class="literal">build-type:</code> <em class="replaceable"><code>identifier</code></em>
            </span></dt><dd><p>The type of build used by this package.
                Build types are the constructors of the <a class="ulink" href="../libraries/Cabal/Distribution-PackageDescription.html#t:BuildType" target="_top"><code class="literal">BuildType</code></a> type,
                defaulting to <code class="literal">Custom</code>.
                If this field is given a value other than
                <code class="literal">Custom</code>, some tools such as
                <code class="literal">cabal-install</code> will be able to
                build the package without using the setup script. So if you are
                just using the default <code class="literal">Setup.hs</code> then set
                the build type as <code class="literal">Simple</code>.</p></dd><dt><span class="term">
              <code class="literal">license:</code> <em class="replaceable"><code>identifier</code></em>
              (default: <code class="literal">AllRightsReserved</code>)
            </span></dt><dd><p>The type of license under which this package is
                distributed.  License names are the constants of the
                <a class="ulink" href="../libraries/Cabal/Distribution-License.html#t:License" target="_top"><code class="literal">License</code></a> type.</p></dd><dt><span class="term">
              <code class="literal">license-file:</code>
              <em class="replaceable"><code>filename</code></em>
            </span></dt><dd><p>The name of a file containing the precise license
                for this package. It will be installed with the package.
              </p></dd><dt><span class="term">
              <code class="literal">copyright:</code>
              <em class="replaceable"><code>freeform</code></em>
            </span></dt><dd><p>The content of a copyright notice, typically the
                name of the holder of the copyright on the package and
                the year(s) from which copyright is claimed.</p><p>For example:
              <code class="literal">Copyright: (c) 2006-2007 Joe Bloggs</code>
              </p></dd><dt><span class="term">
              <code class="literal">author:</code>
              <em class="replaceable"><code>freeform</code></em>
            </span></dt><dd><p>The original author of the package.</p></dd><dt><span class="term">
              <code class="literal">maintainer:</code>
              <em class="replaceable"><code>address</code></em>
            </span></dt><dd><p>The current maintainer or maintainers of the package.
                This is an e-mail address to which users should send bug
                reports, feature requests and patches.</p></dd><dt><span class="term">
              <code class="literal">stability:</code>
              <em class="replaceable"><code>freeform</code></em>
            </span></dt><dd><p>The stability level of the package, e.g.
                <code class="literal">alpha</code>, <code class="literal">experimental</code>,
                <code class="literal">provisional</code>,
                <code class="literal">stable</code>.</p></dd><dt><span class="term">
              <code class="literal">homepage:</code> <em class="replaceable"><code>URL</code></em>
            </span></dt><dd><p>The package homepage.</p></dd><dt><span class="term">
              <code class="literal">bug-reports:</code> <em class="replaceable"><code>URL</code></em>
            </span></dt><dd><p>
                The URL where users should direct bug reports. This would
                normally be either:
                </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                          A <code class="literal">mailto:</code> URL, eg for a person or a
                          mailing list.
                        </p></li><li class="listitem"><p>
                          An <code class="literal">http:</code> (or <code class="literal">https:</code>)
                          URL for an online bug tracking system.
                        </p></li></ul></div><p>
              For example Cabal itself uses a web-based bug tracking system
              </p><pre class="programlisting">bug-reports: http://hackage.haskell.org/trac/hackage/</pre><p>
              </p></dd><dt><span class="term">
              <code class="literal">package-url:</code> <em class="replaceable"><code>URL</code></em>
            </span></dt><dd><p>The location of a source bundle for the package.
                The distribution should be a Cabal package.</p></dd><dt><span class="term">
              <code class="literal">synopsis:</code>
              <em class="replaceable"><code>freeform</code></em>
            </span></dt><dd><p>A very short description of the package, for use in
                a table of packages.  This is your headline, so keep
                it short (one line) but as informative as possible.
                Save space by not including the package name or saying
                it's written in Haskell.</p></dd><dt><span class="term">
              <code class="literal">description:</code>
              <em class="replaceable"><code>freeform</code></em>
            </span></dt><dd><p>Description of the package.  This may be several
                paragraphs, and should be aimed at a Haskell programmer
                who has never heard of your package before.</p><p>For library packages, this field is used as
                prologue text by <span class="command"><strong>setup haddock</strong></span>
                (see <a class="xref" href="builders.html#setup-haddock" title="4.4. setup haddock">Section 4.4, &#8220;setup haddock&#8221;</a>), and thus may
                contain the same markup as <a class="ulink" href="http://www.haskell.org/haddock/" target="_top"><span class="command"><strong>haddock</strong></span></a> documentation
                comments.</p></dd><dt><span class="term">
              <code class="literal">category:</code>
              <em class="replaceable"><code>freeform</code></em>
            </span></dt><dd><p>A classification category for future use by the
                package catalogue <em class="firstterm">Hackage</em>.  These
                categories have not yet been specified, but the upper
                levels of the module hierarchy make a good start.</p></dd><dt><span class="term">
              <code class="literal">tested-with:</code>
              <em class="replaceable"><code>compiler list</code></em>
            </span></dt><dd><p>A list of compilers and versions against which the
                package has been tested (or at least built).</p></dd><dt><span class="term">
              <code class="literal">data-files:</code>
              <em class="replaceable"><code>filename list</code></em>
            </span></dt><dd><p>A list of files to be installed for run-time use by
                the package.  This is useful for packages that use a
                large amount of static data, such as tables of values
                or code templates.  For details on how to find these
                files at run-time, see
                <a class="xref" href="authors.html#paths-module" title="3.2. Accessing data files from package code">Section 3.2, &#8220;Accessing data files from package code&#8221;</a>.</p><p>
		A limited form of <code class="literal">*</code> wildcards in file names,
		for example <code class="literal">data-files: images/*.png</code> matches
		all the <code class="literal">.png</code> files in the
		<code class="literal">images</code> directory.
	      </p><p>
		The limitation is that <code class="literal">*</code> wildcards are only
		allowed in place of the file name, not in the directory name or
		file extension.  In particular, wildcards do not include
		directories contents recursively. Furthermore, if a wildcard is
		used it must be used with an extension, so <code class="literal">data-files:
		data/*</code> is not allowed. When matching a wildcard plus
		extension, a file's full extension must match exactly, so
		<code class="literal">*.gz</code> matches <code class="literal">foo.gz</code> but
		not <code class="literal">foo.tar.gz</code>. A wildcard that does not
		match any files is an error.
	      </p><p>
		The reason for providing only a very limited form of wildcard
		is to concisely express the common case of a large number of
		related files of the same file type without making it too easy
		to accidentally include unwanted files.
	      </p></dd><dt><span class="term">
              <code class="literal">data-dir:</code>
              <em class="replaceable"><code>directory</code></em>
            </span></dt><dd><p>The directory where Cabal looks for data files to install,
                relative to the source directory. By default, Cabal will look
                in the source directory itself.</p></dd><dt><span class="term">
              <code class="literal">extra-source-files:</code>
              <em class="replaceable"><code>filename list</code></em>
            </span></dt><dd><p>A list of additional files to be included in source
                distributions built with <span class="command"><strong>setup sdist</strong></span>
                (see <a class="xref" href="builders.html#setup-sdist" title="4.12. setup sdist">Section 4.12, &#8220;setup sdist&#8221;</a>).</p><p>As with <code class="literal">data-files</code> it can use a limited
		form of <code class="literal">*</code> wildcards in file names.</p></dd><dt><span class="term">
              <code class="literal">extra-tmp-files:</code>
              <em class="replaceable"><code>filename list</code></em>
            </span></dt><dd><p>A list of additional files or directories to be
                removed by <span class="command"><strong>setup clean</strong></span>
                (see <a class="xref" href="builders.html#setup-clean" title="4.10. setup clean">Section 4.10, &#8220;setup clean&#8221;</a>).
                These would typically be additional files created by
                additional hooks, such as the scheme described in
                <a class="xref" href="authors.html#system-dependent" title="3.3. System-dependent parameters">Section 3.3, &#8220;System-dependent parameters&#8221;</a>.</p></dd></dl></div></div><div class="sect3" title="3.1.2. Library"><div class="titlepage"><div><div><h4 class="title"><a name="library"></a>3.1.2. Library</h4></div></div></div><p>The library section should contain the following
        fields:</p><div class="variablelist"><dl><dt><span class="term">
              <code class="literal">exposed-modules:</code>
              <em class="replaceable"><code>identifier list</code></em>
              (required if this package contains a library)
            </span></dt><dd><p>A list of modules added by this package.</p></dd><dt><span class="term">
              <code class="literal">exposed:</code> <em class="replaceable"><code>boolean</code></em>
              (default: <code class="literal">True</code>)
            </span></dt><dd><p>
		Some Haskell compilers (notably GHC) support the notion of
		packages being <span class="quote">&#8220;<span class="quote">exposed</span>&#8221;</span> or <span class="quote">&#8220;<span class="quote">hidden</span>&#8221;</span>
		which means the modules they provide can be easily imported
		without always having to specify which package they come from.
		However this only works effectively if the modules provided by
		all exposed packages do not overlap (otherwise a module import
		would be ambiguous).
	      </p><p>
		Almost all new libraries use hierarchical module names that do
		not clash, so it is very uncommon to have to use this field.
		However it may be necessary to set <code class="literal">exposed:
		False</code> for some old libraries that use a flat module
		namespace or where it is known that the exposed modules would
		clash with other common modules.
	      </p></dd></dl></div><p>The library section may also contain build information fields
          (see <a class="xref" href="authors.html#buildinfo" title="3.1.4. Build information">Section 3.1.4, &#8220;Build information&#8221;</a>).</p></div><div class="sect3" title="3.1.3. Executables"><div class="titlepage"><div><div><h4 class="title"><a name="executable"></a>3.1.3. Executables</h4></div></div></div><p>Executable sections (if present) describe executable
        programs contained in the package and must have an argument
        after the section label, which defines the name of the
        executable.  This is a freeform argument but may not contain
        spaces.</p><p>The executable may be described using the following
        fields, as well as build information fields (see <a class="xref" href="authors.html#buildinfo" title="3.1.4. Build information">Section 3.1.4, &#8220;Build information&#8221;</a>).</p><div class="variablelist"><dl><dt><span class="term">
              <code class="literal">main-is:</code> <em class="replaceable"><code>filename</code></em>
              (required)
            </span></dt><dd><p>The name of the <code class="filename">.hs</code> or
                <code class="filename">.lhs</code> file containing the
                <code class="literal">Main</code> module. Note that it is the
                <code class="filename">.hs</code> filename that must be listed, even if
                that file is generated using a preprocessor. The source
                file must be relative to one of the directories listed in
                <code class="literal">hs-source-dirs</code>.
              </p></dd></dl></div></div><div class="sect3" title="3.1.4. Build information"><div class="titlepage"><div><div><h4 class="title"><a name="buildinfo"></a>3.1.4. Build information</h4></div></div></div><p>The following fields may be optionally present in a
        library or executable section, and give information for the
        building of the corresponding library or executable.  See also
        <a class="xref" href="authors.html#system-dependent" title="3.3. System-dependent parameters">Section 3.3, &#8220;System-dependent parameters&#8221;</a> and <a class="xref" href="authors.html#configurations" title="3.1.5. Configurations">Section 3.1.5, &#8220;Configurations&#8221;</a>
        for a way to supply system-dependent values for these
        fields.</p><div class="variablelist"><dl><dt><span class="term">
              <code class="literal">build-depends:</code>
              <em class="replaceable"><code>package list</code></em>
            </span></dt><dd><p>A list of packages needed to build this one. Each package
	      can be annotated with a version constraint.
	      </p><p>
                Version constraints use the operators <code class="literal">==, &gt;=, &gt;,
		&lt;, &lt;=</code> and a version number. Multiple
		constraints can be combined using <code class="literal">&amp;&amp;</code>
		or <code class="literal">||</code>. If no version constraint is
		specified, any version is assumed to be	acceptable.
		For example:
	      </p><pre class="programlisting">
library
  build-depends:
    base &gt;= 2,
    foo &gt;= 1.2 &amp;&amp; &lt; 1.3,
    bar
</pre><p>
	        Dependencies like <code class="literal">foo &gt;= 1.2 &amp;&amp; &lt; 1.3</code> turn
		out to be very common because it is recommended	practise for
		package versions to correspond to API versions. There is a
		special syntax to support this use:
	      </p><pre class="programlisting">build-depends: foo ==1.2.*</pre><p>
	        It is only syntactic sugar. It is exactly equivalent to
		<code class="literal">foo &gt;= 1.2 &amp;&amp; &lt; 1.3</code>.
	      </p></dd><dt><span class="term">
              <code class="literal">other-modules:</code>
              <em class="replaceable"><code>identifier list</code></em>
            </span></dt><dd><p>A list of modules used by the component
                but not exposed to users.  For a library component, these
                would be hidden modules of the library.  For an executable,
                these would be auxiliary modules to be linked with the
                file named in the <code class="literal">main-is</code> field.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Every module in the package <span class="emphasis"><em>must</em></span> be
		listed in one of <code class="literal">other-modules</code>,
		<code class="literal">exposed-modules</code> or
		<code class="literal">main-is</code> fields.
		</p></div></dd><dt><span class="term">
              <code class="literal">hs-source-dirs:</code>
              <em class="replaceable"><code>directory list</code></em>
              (default: <span class="quote">&#8220;<span class="quote"><code class="literal">.</code></span>&#8221;</span>)
            </span></dt><dd><p>Root directories for the module hierarchy.</p><p>For backwards compatibility, the old variant
                <code class="literal">hs-source-dir</code> is also recognized.</p></dd><dt><span class="term">
              <code class="literal">extensions:</code>
              <em class="replaceable"><code>identifier list</code></em>
            </span></dt><dd><p>A list of Haskell extensions used by every module.
                Extension names are the constructors of the <a class="ulink" href="../libraries/Cabal/Language-Haskell-Extension.html#t:Extension" target="_top"><code class="literal">Extension</code></a> type.
                These determine corresponding compiler options.
                In particular, <code class="literal">CPP</code> specifies that
                Haskell source files are to be preprocessed with a
                C preprocessor.</p><p>Extensions used only by one module may be specified
                by placing a <code class="literal">LANGUAGE</code> pragma in the
                source file affected, e.g.:</p><pre class="programlisting">{-# LANGUAGE CPP, MultiParamTypeClasses #-}</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>GHC versions prior to 6.6 do not support the
                  <code class="literal">LANGUAGE</code> pragma.</p></div></dd><dt><span class="term">
              <code class="literal">build-tools:</code>
              <em class="replaceable"><code>program list</code></em>
            </span></dt><dd><p>A list of programs, possibly annotated with versions,
                needed to build this package,
                e.g. <code class="literal">c2hs &gt; 0.15, cpphs</code>.
                If no version constraint is specified, any version is
                assumed to be acceptable.</p></dd><dt><span class="term">
              <code class="literal">buildable:</code> <em class="replaceable"><code>boolean</code></em>
              (default: <code class="literal">True</code>)
            </span></dt><dd><p>Is the component buildable?
                Like some of the other fields below, this field is
                more useful with the slightly more elaborate form of
                the simple build infrastructure described in
                <a class="xref" href="authors.html#system-dependent" title="3.3. System-dependent parameters">Section 3.3, &#8220;System-dependent parameters&#8221;</a>.</p></dd><dt><span class="term">
              <code class="literal">ghc-options:</code>
              <em class="replaceable"><code>token list</code></em>
            </span></dt><dd><p>Additional options for GHC.  You can often achieve
                the same effect using the <code class="literal">extensions</code>
                field, which is preferred.</p><p>Options required only by one module may be specified
                by placing an <code class="literal">OPTIONS_GHC</code> pragma in the
                source file affected.</p></dd><dt><span class="term">
              <code class="literal">ghc-prof-options:</code>
              <em class="replaceable"><code>token list</code></em>
            </span></dt><dd><p>Additional options for GHC when the package is built
                with profiling enabled.</p></dd><dt><span class="term">
              <code class="literal">ghc-shared-options:</code>
              <em class="replaceable"><code>token list</code></em>
            </span></dt><dd><p>Additional options for GHC when the package is
              built as shared library.</p></dd><dt><span class="term">
              <code class="literal">hugs-options:</code>
              <em class="replaceable"><code>token list</code></em>
            </span></dt><dd><p>Additional options for Hugs.  You can often achieve
                the same effect using the <code class="literal">extensions</code>
                field, which is preferred.</p><p>Options required only by one module may be specified
                by placing an <code class="literal">OPTIONS_HUGS</code> pragma in the
                source file affected.</p></dd><dt><span class="term">
              <code class="literal">nhc98-options:</code>
              <em class="replaceable"><code>token list</code></em>
            </span></dt><dd><p>Additional options for nhc98.  You can often achieve
                the same effect using the <code class="literal">extensions</code>
                field, which is preferred.</p><p>Options required only by one module may be specified
                by placing an <code class="literal">OPTIONS_NHC98</code> pragma in the
                source file affected.</p><p>Warning: Cabal does not currently support building
                libraries or executables with nhc98 anyway.</p></dd><dt><span class="term">
              <code class="literal">includes:</code>
              <em class="replaceable"><code>filename list</code></em>
            </span></dt><dd><p>A list of header files to be included in any
              compilations via C.  This field applies to both header
              files that are already installed on the system and to
              those coming with the package to be installed.  These files
              typically contain function prototypes for foreign imports
              used by the package.</p></dd><dt><span class="term">
              <code class="literal">install-includes:</code>
              <em class="replaceable"><code>filename list</code></em>
            </span></dt><dd><p>A list of header files from this package to be
              installed into
              <code class="literal">$libdir/includes</code> when the package
              is installed.  Files listed in
              <code class="literal">install-includes:</code> should be found in
              relative to the top of the source tree or relative to one of the
              directories listed in <code class="literal">include-dirs</code>.</p><p><code class="literal">install-includes</code> is typically
	      used to name header files that contain prototypes for
	      foreign imports used in Haskell code in this package,
	      for which the C implementations are also provided with
	      the package.  Note that to include them when compiling
	      the package itself, they need to be listed in the
	      <code class="literal">includes:</code> field as well.</p></dd><dt><span class="term">
              <code class="literal">include-dirs:</code>
              <em class="replaceable"><code>directory list</code></em>
            </span></dt><dd><p>A list of directories to search for header files,
                when preprocessing with <span class="command"><strong>c2hs</strong></span>,
                <span class="command"><strong>hsc2hs</strong></span>, <span class="command"><strong>ffihugs</strong></span>,
                <span class="command"><strong>cpphs</strong></span> or the C preprocessor,
		and also when compiling via C.</p></dd><dt><span class="term">
              <code class="literal">c-sources:</code>
              <em class="replaceable"><code>filename list</code></em>
            </span></dt><dd><p>A list of C source files to be compiled
                and linked with the Haskell files.</p><p>If you use this field, you should also name the
                C files in <code class="literal">CFILES</code> pragmas in the
                Haskell source files that use them, e.g.:
                </p><pre class="screen">{-# CFILES dir/file1.c dir/file2.c #-}</pre><p>
                These are ignored by the compilers, but needed by Hugs.</p></dd><dt><span class="term">
              <code class="literal">extra-libraries:</code>
              <em class="replaceable"><code>token list</code></em>
            </span></dt><dd><p>A list of extra libraries to link with.</p></dd><dt><span class="term">
              <code class="literal">extra-lib-dirs:</code>
              <em class="replaceable"><code>directory list</code></em>
            </span></dt><dd><p>A list of directories to search for libraries.</p></dd><dt><span class="term">
              <code class="literal">cc-options:</code>
              <em class="replaceable"><code>token list</code></em>
            </span></dt><dd><p>Command-line arguments to be passed to the C compiler.
                Since the arguments are compiler-dependent, this field
                is more useful with the setup described in
                <a class="xref" href="authors.html#system-dependent" title="3.3. System-dependent parameters">Section 3.3, &#8220;System-dependent parameters&#8221;</a>.</p></dd><dt><span class="term">
              <code class="literal">ld-options:</code>
              <em class="replaceable"><code>token list</code></em>
            </span></dt><dd><p>Command-line arguments to be passed to the linker.
                Since the arguments are compiler-dependent, this field
                is more useful with the setup described in
                <a class="xref" href="authors.html#system-dependent" title="3.3. System-dependent parameters">Section 3.3, &#8220;System-dependent parameters&#8221;</a>.</p></dd><dt><span class="term">
              <code class="literal">pkgconfig-depends:</code>
              <em class="replaceable"><code>package list</code></em>
            </span></dt><dd><p>A list of <a class="ulink" href="http://pkg-config.freedesktop.org/" target="_top">pkg-config</a> packages, needed to build this
                package. They can be annotated with versions,
                e.g. <code class="literal">gtk+-2.0 &gt;= 2.10, cairo &gt;= 1.0</code>.
                If no version constraint is specified, any version is
                assumed to be acceptable. Cabal uses
                <code class="literal">pkg-config</code> to find if the packages are
                available on the system and to find the extra compilation and
                linker options needed to use the packages.
              </p><p> If you need to bind to a C library that supports
                <code class="literal">pkg-config</code> (use
                <code class="literal">pkg-config --list-all</code> to find out if it is
                supported) then it is much preferable to use this field rather
                than hard code options into the other fields.
              </p></dd><dt><span class="term">
              <code class="literal">frameworks:</code>
              <em class="replaceable"><code>token list</code></em>
            </span></dt><dd><p>On Darwin/MacOS X, a list of frameworks to link to.
                See Apple's developer documentation for more details
                on frameworks.  This entry is ignored on all other
                platforms.</p></dd></dl></div></div><div class="sect3" title="3.1.5. Configurations"><div class="titlepage"><div><div><h4 class="title"><a name="configurations"></a>3.1.5. Configurations</h4></div></div></div><p>Library and executable sections may include conditional
	blocks, which test for various system parameters and
	configuration flags.  The flags mechanism is rather generic,
	but most of the time a flag represents certain feature, that
	can be switched on or off by the package user.</p><p>Here is an example package description file using
	configurations:</p><div class="example"><a name="package-with-configurations-example"></a><p class="title"><b>Example 4. A package containing a library and executable programs</b></p><div class="example-contents"><pre class="programlisting">Name: Test1
Version: 0.0.1
Cabal-Version: &gt;= 1.2
License: BSD3
Author:  Jane Doe
Synopsis: Test package to test configurations
Category: Example

Flag Debug
  Description: Enable debug support
  Default:     False

Flag WebFrontend
  Description: Include API for web frontend.
  -- Cabal checks if the configuration is possible, first
  -- with this flag set to True and if not it tries with False

Library
  Build-Depends:   base
  Exposed-Modules: Testing.Test1
  Extensions:      CPP

  if flag(debug)
    GHC-Options: -DDEBUG
    if !os(windows)
      CC-Options: "-DDEBUG"
    else
      CC-Options: "-DNDEBUG"

  if flag(webfrontend)
    Build-Depends: cgi &gt; 0.42
    Other-Modules: Testing.WebStuff

Executable test1
  Main-is: T1.hs
  Other-Modules: Testing.Test1
  Build-Depends: base

  if flag(debug)
    CC-Options: "-DDEBUG"
    GHC-Options: -DDEBUG
</pre></div></div><br class="example-break"><div class="sect4" title="3.1.5.1. Layout"><div class="titlepage"><div><div><h5 class="title"><a name="id587505"></a>3.1.5.1. Layout</h5></div></div></div><p>Flags, conditionals, library and executable sections use layout to
     indicate structure. This is very similar to the Haskell layout rule.
     Entries in a section have to all be indented to the same level which must
     be more than the section header. Tabs are not allowed to be used for
     indentation.</p><p>As an alternative to using layout you can also use explicit braces
     <code class="literal">{}</code>. In this case the indentation of entries in a
     section does not matter, though different fields within a block must be
     on different lines. Here is a bit of the above example again, using
     braces:</p><div class="example"><a name="configurations-with-braces-example"></a><p class="title"><b>Example 5. Using explicit braces rather than indentation for layout</b></p><div class="example-contents"><pre class="programlisting">Name: Test1
Version: 0.0.1
Cabal-Version: &gt;= 1.2
License: BSD3
Author:  Jane Doe
Synopsis: Test package to test configurations
Category: Example

Flag Debug {
  Description: Enable debug support
  Default:     False
}

Library {
  Build-Depends:   base
  Exposed-Modules: Testing.Test1
  Extensions:      CPP
  if flag(debug) {
    GHC-Options: -DDEBUG
    if !os(windows) {
      CC-Options: "-DDEBUG"
    } else {
      CC-Options: "-DNDEBUG"
    }
  }
}
</pre></div></div><br class="example-break"></div><div class="sect4" title="3.1.5.2. Configuration Flags"><div class="titlepage"><div><div><h5 class="title"><a name="id587547"></a>3.1.5.2. Configuration Flags</h5></div></div></div><p>A flag section takes the flag name as an argument and
	 may contain the following fields.</p><div class="variablelist"><dl><dt><span class="term">
              <code class="literal">description:</code>
              <em class="replaceable"><code>freeform</code></em>
            </span></dt><dd><p>The description of this flag.</p></dd><dt><span class="term">
              <code class="literal">default:</code>
              <em class="replaceable"><code>boolean</code></em>
	      (default: <code class="literal">True</code>)
            </span></dt><dd><p>The default value of this flag.</p><p>Note that this value may be overridden in several
	      ways (see <a class="xref" href="builders.html#flag-control" title="4.1.3. Controlling Flag Assignments">Section 4.1.3, &#8220;Controlling Flag Assignments&#8221;</a>).  The
	      rationale for having flags default to True is that users
	      usually want new features as soon as they are available.
	      Flags representing features that are not (yet)
	      recommended for most users (such as experimental
	      features or debugging support) should therefore
	      explicitly override the default to False.</p></dd><dt><span class="term">
              <code class="literal">manual:</code>
              <em class="replaceable"><code>boolean</code></em>
              (default: <code class="literal">False</code>)
            </span></dt><dd><p>By default, Cabal will first try to satisfy
              dependencies with the default flag value and then,
              if that is not possible, with the negated value.
              However, if the flag is manual, then the default
              value (which can be overridden by commandline flags)
              will be used.</p></dd></dl></div></div><div class="sect4" title="3.1.5.3. Conditional Blocks"><div class="titlepage"><div><div><h5 class="title"><a name="conditionals"></a>3.1.5.3. Conditional Blocks</h5></div></div></div><p>Conditional blocks may appear anywhere inside a
	  library or executable section.  They have to follow rather
	  strict formatting rules.</p><p>Conditional blocks must always be of the shape
	  </p><div class="literallayout"><p><br>
	    <code class="literal">if </code><em class="replaceable"><code>condition</code></em><br>
	         <em class="replaceable"><code>property-descriptions-or-conditionals*</code></em><br>
    </p></div><p>or
	  </p><div class="literallayout"><p><br>
	    <code class="literal">if </code><em class="replaceable"><code>condition</code></em><br>
	         <em class="replaceable"><code>property-descriptions-or-conditionals*</code></em><br>
	    <code class="literal">else</code><br>
	         <em class="replaceable"><code>property-descriptions-or-conditionals*</code></em><br>
	  </p></div><p>Note that the <code class="literal">if</code> and the condition have to
	  be all on the same line.</p></div><div class="sect4" title="3.1.5.4. Conditions"><div class="titlepage"><div><div><h5 class="title"><a name="conditions"></a>3.1.5.4. Conditions</h5></div></div></div><p>Conditions can be formed using boolean tests and the
	  boolean operators <code class="literal">||</code> (disjunction /
	  logical "or"), <code class="literal">&amp;&amp;</code> (conjunction /
	  logical "and"), or <code class="literal">!</code> (negation / logical
	  "not").  The unary <code class="literal">!</code> takes highest
	  precedence, <code class="literal">||</code> takes lowest.  Precedence
	  levels may be overridden through the use of parentheses.
	  For example, <code class="literal">os(darwin) &amp;&amp; !arch(i386) || os(freebsd)</code>
          is equivalent to <code class="literal">(os(darwin) &amp;&amp; !(arch(i386))) || os(freebsd)</code>.
	  </p><p>The following tests are currently supported.</p><div class="variablelist"><dl><dt><span class="term">
		<code class="literal">os(</code>
		<em class="replaceable"><code>name</code></em>
		<code class="literal">)</code>
	      </span></dt><dd><p>Tests if the current operating system is
              <em class="replaceable"><code>name</code></em>.  The argument is tested
              against <code class="literal">System.Info.os</code> on 
              the target system. There is unfortunately some disagreement
              between Haskell implementations about the standard values of
              <code class="literal">System.Info.os</code>. Cabal canonicalises it so
              that in particular <code class="literal">os(windows)</code> works on all
              implementations. If the canonicalised os names match, this test
              evaluates to true, otherwise false. The match is
              case-insensitive. </p></dd><dt><span class="term">
		<code class="literal">arch(</code>
		<em class="replaceable"><code>name</code></em>
		<code class="literal">)</code>
	      </span></dt><dd><p>Tests if the current architecture is
              <em class="replaceable"><code>name</code></em>.  The argument is matched
              against <code class="literal">System.Info.arch</code> on the target system.
              If the arch names match, this test evaluates to true,
              otherwise false. The match is case-insensitive. </p></dd><dt><span class="term">
		<code class="literal">impl(</code>
		<em class="replaceable"><code>compiler</code></em>
		<code class="literal">)</code>
	      </span></dt><dd><p>Tests for the configured Haskell implementation. An optional
              version constraint may be specified (for example
              <code class="literal">impl(ghc &gt;= 6.6.1)</code>).  If the
              configured implementation is of the right type and matches the
              version constraint, then this evaluates to true,
              otherwise false. The match is case-insensitive.</p></dd><dt><span class="term">
		<code class="literal">flag(</code>
		<em class="replaceable"><code>name</code></em>
		<code class="literal">)</code>
	      </span></dt><dd><p>Evaluates to the current assignment of the flag of
              the given name.  Flag names are case insensitive.
              Testing for flags that have not been introduced with a
              flag section is an error.</p></dd><dt><span class="term">
		<code class="literal">true</code>
	      </span></dt><dd><p>Constant value true.</p></dd><dt><span class="term">
		<code class="literal">false</code>
	      </span></dt><dd><p>Constant value false.</p></dd></dl></div></div><div class="sect4" title="3.1.5.5. Resolution of Conditions and Flags"><div class="titlepage"><div><div><h5 class="title"><a name="conditional-resolution"></a>3.1.5.5. Resolution of Conditions and Flags</h5></div></div></div><p>If a package descriptions specifies configuration flags
	  the package user can control these in several ways (see
          <a class="xref" href="builders.html#flag-control" title="4.1.3. Controlling Flag Assignments">Section 4.1.3, &#8220;Controlling Flag Assignments&#8221;</a>). If the user does not fix the
          value of a flag, Cabal will try to find a flag assignment in the
	  following way.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>For each flag specified, it will assign its default
	      value, evaluate all conditions with this flag assignment,
	      and check if all dependencies can be satisfied.  If this
	      check succeeded, the package will be configured with those
	      flag assignments.</p></li><li class="listitem"><p>If dependencies were missing, the last flag (as by
	      the order in which the flags were introduced in the
	      package description) is tried with its alternative value
	      and so on.  This continues until either an assignment is
	      found where all dependencies can be satisfied, or all
	      possible flag assignments have been tried.</p></li></ul></div><p>To put it another way, Cabal does a complete backtracking
          search to find a satisfiable package configuration. It is only the
          dependencies specified in the <code class="literal">build-depends</code> field
          in conditional blocks that determine if a particular flag assignment
          is satisfiable (<code class="literal">build-tools</code> are not considered).
          The order of the declaration and the default value of the flags
          determines the search order. Flags overridden on the command line fix
          the assignment of that flag, so no backtracking will be tried for
          that flag.</p><p>If no suitable flag assignment could be found, the
	  configuration phase will fail and a list of missing
	  dependencies will be printed.  Note that this resolution
	  process is exponential in the worst case (i.e., in the case
	  where dependencies cannot be satisfied).  There are some
	  optimizations applied internally, but the overall complexity
	  remains unchanged.</p></div><div class="sect4" title="3.1.5.6. Meaning of field values when using conditionals"><div class="titlepage"><div><div><h5 class="title"><a name="prop-combine"></a>3.1.5.6. Meaning of field values when using conditionals</h5></div></div></div><p>During the configuration phase, a flag assignment is
	  chosen, all conditionals are evaluated, and the package description
          is combined into a flat package descriptions. If the same field
	  both inside a conditional and outside then they are combined using
          the following rules.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Boolean fields are combined using conjunction
	      (logical "and").</p></li><li class="listitem"><p>List fields are combined by appending the inner
	      items to the outer items, for example
	      </p><pre class="programlisting">Extensions: CPP
if impl(ghc) || impl(hugs)
  Extensions: MultiParamTypeClasses
</pre><p>
	    when compiled using Hugs or GHC will be combined to
	    </p><pre class="programlisting">Extensions: CPP, MultiParamTypeClasses</pre><p>
	    </p><p>Similarly, if two conditional sections appear at the
	    same nesting level, properties specified in the latter
	    will come after properties specified in the former.</p></li><li class="listitem"><p>All other fields must not be specified in ambiguous ways.  For example
	      </p><pre class="programlisting">Main-is: Main.hs
if flag(useothermain)
  Main-is: OtherMain.hs
</pre><p>
	      will lead to an error.  Instead use
	      </p><pre class="programlisting">if flag(useothermain)
  Main-is: OtherMain.hs
else
  Main-is: Main.hs
</pre></li></ul></div></div></div><div class="sect3" title="3.1.6. Source Repositories"><div class="titlepage"><div><div><h4 class="title"><a name="source-repos"></a>3.1.6. Source Repositories</h4></div></div></div><p>
	        It is often useful to be able to specify a source revision control
	        repository for a package. Cabal lets you specifying this information
	        in a relatively structured form which enables other tools to
	        interpret and make effective use of the information. For example the
	        information should be sufficient for an automatic tool to checkout
	        the sources.
	      </p><p>
	        Cabal supports specifying different information for various common
	        source control systems. Obviously not all automated tools will
	        support all source control systems.
	      </p><p>
	        Cabal supports specifying repositories for different use cases. By
	        declaring which case we mean automated tools can be more useful.
	        There are currently two kinds defined:
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
            The <code class="literal">head</code> kind refers to the
            latest development branch of the package. This may be used for
            example to track activity of a project or as an indication to
            outside developers what sources to get for making new
            contributions.
          </p></li><li class="listitem"><p>
            The <code class="literal">this</code> kind refers to the
            branch and tag of a repository that contains the sources for this
            version or release of a package. For most source control systems
            this involves specifying a tag, id or hash of some form and
            perhaps a branch. The purpose is to be able to reconstruct the
            sources corresponding to a particular package version. This might
            be used to indicate what sources to get if someone needs to fix a
            bug in an older branch that is no longer an active head branch.
          </p></li></ul></div><p>
	      </p><p>
	        You can specify one kind or the other or both. As an example here are
	        the repositories for the Cabal library. Note that the
	        <code class="literal">this</code> kind of repo specifies a tag.
  	      </p><pre class="programlisting">
source-repository head
  type:     darcs
  location: http://darcs.haskell.org/cabal/

source-repository this
  type:     darcs
  location: http://darcs.haskell.org/cabal-branches/cabal-1.6/
  tag:      1.6.1
</pre><p>
        </p><p>
          The exact fields are as follows:
        </p><div class="variablelist"><dl><dt><span class="term">
            <code class="literal">type:</code>
            <em class="replaceable"><code>token</code></em>
          </span></dt><dd><p>
              The name of the source control system used for this repository.
              The currently recognised types are:
              </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>darcs</p></li><li class="listitem"><p>git</p></li><li class="listitem"><p>svn</p></li><li class="listitem"><p>cvs</p></li><li class="listitem"><p>mercurial (or alias hg)</p></li><li class="listitem"><p>bazaar (or alias bzr)</p></li><li class="listitem"><p>arch</p></li><li class="listitem"><p>monotone</p></li></ul></div><p>
            </p><p>
              This field is required.
            </p></dd><dt><span class="term">
            <code class="literal">location:</code>
            <em class="replaceable"><code>URL</code></em>
          </span></dt><dd><p>
              The location of the repository. The exact form of this field
              depends on the repository type. For example:
              </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>for darcs: <code class="literal">http://code.haskell.org/foo/</code></p></li><li class="listitem"><p>for git: <code class="literal">git://github.com/foo/bar.git</code></p></li><li class="listitem"><p>for CVS: <code class="literal">anoncvs@cvs.foo.org:/cvs</code></p></li></ul></div><p>
            </p><p>
              This field is required.
            </p></dd><dt><span class="term">
            <code class="literal">module:</code>
            <em class="replaceable"><code>token</code></em>
          </span></dt><dd><p>
              CVS requires a named module, as each CVS server can host multiple
              named repositories.
            </p><p>
              This field is required for the CVS repo type and should not be
              used otherwise.
            </p></dd><dt><span class="term">
            <code class="literal">branch:</code>
            <em class="replaceable"><code>token</code></em>
          </span></dt><dd><p>
              Many source control systems support the notion of a branch,
              as a distinct concept from having repositories in separate
              locations. For example CVS, SVN and git use branches while for
              darcs uses different locations for different branches. If you
              need to specify a branch to identify a your repository
              then specify it in this field.
            </p><p>
              This field is optional.
            </p></dd><dt><span class="term">
            <code class="literal">tag:</code>
            <em class="replaceable"><code>token</code></em>
          </span></dt><dd><p>
              A tag identifies a particular state of a source repository. The
              tag can be used with a <code class="literal">this</code> repo kind to
              identify the state of a repo corresponding to a particular
              package version or release. The exact form of the tag depends on
              the repository type.
            </p><p>
              This field is required for the <code class="literal">this</code> repo kind.
            </p></dd><dt><span class="term">
            <code class="literal">subdir:</code>
            <em class="replaceable"><code>directory</code></em>
          </span></dt><dd><p>
              Some projects put the sources for multiple packages under a
              single source repository. This field lets you specify the
              relative path from the root of the repository to the top
              directory for the package, ie the directory containing the
              package's <code class="literal">.cabal</code> file.
            </p><p>
              This field is optional. It default to empty which corresponds to
              the root directory of the repository.
            </p></dd></dl></div></div></div><div class="sect2" title="3.2. Accessing data files from package code"><div class="titlepage"><div><div><h3 class="title"><a name="paths-module"></a>3.2. Accessing data files from package code</h3></div></div></div><p>The placement on the target system of files listed in the
	<code class="literal">data-files</code> field varies between systems, and in
	some cases one can even move packages around after installation
	(see <a class="xref" href="builders.html#prefix-independence" title="4.1.2.3. Prefix-independence">Section 4.1.2.3, &#8220;Prefix-independence&#8221;</a>).  To enable packages
	to find these files in a portable way, Cabal generates a module
	called <code class="literal">Paths_</code><em class="replaceable"><code>pkgname</code></em>
	(with any hyphens in <em class="replaceable"><code>pkgname</code></em> replaced
	by underscores) during building, so that it may be imported by
	modules of the package.  This module defines a function
	</p><pre class="programlisting">getDataFileName :: FilePath -&gt; IO FilePath</pre><p>
	If the argument is a filename listed in the
	<code class="literal">data-files</code> field, the result is the name
	of the corresponding file on the system on which the program
	is running.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you decide to import the
	  <code class="literal">Paths_</code><em class="replaceable"><code>pkgname</code></em> module then
	  it <span class="emphasis"><em>must</em></span> be listed in the
	  <code class="literal">other-modules</code> field just like any other module in
	  your package.
	</p><p>The <code class="literal">Paths_</code><em class="replaceable"><code>pkgname</code></em>
	  module is not platform independent so it does not get included in the
	  source tarballs generated by <span class="command"><strong>sdist</strong></span>.
	</p></div></div><div class="sect2" title="3.3. System-dependent parameters"><div class="titlepage"><div><div><h3 class="title"><a name="system-dependent"></a>3.3. System-dependent parameters</h3></div></div></div><p>For some packages, especially those interfacing with C
        libraries, implementation details and the build procedure depend
        on the build environment.  A variant of the simple build
        infrastructure (the <code class="literal">build-type</code>
        <code class="literal">Configure</code>) handles many such situations using
        a slightly longer <code class="filename">Setup.hs</code>:</p><pre class="programlisting">
import Distribution.Simple
main = defaultMainWithHooks autoconfUserHooks</pre><p>Most packages, however, would probably do better with
        configurations (see <a class="xref" href="authors.html#configurations" title="3.1.5. Configurations">Section 3.1.5, &#8220;Configurations&#8221;</a>).</p><p>This program differs from <code class="literal">defaultMain</code>
        in two ways:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The package root directory must contain a shell script called
	    <code class="filename">configure</code>. The configure step will run the
	    script. This <code class="filename">configure</code> script may
            be produced by <a class="ulink" href="http://www.gnu.org/software/autoconf/" target="_top"><span class="command"><strong>autoconf</strong></span></a> or may be hand-written. The
	    <code class="filename">configure</code> script typically
            discovers information about the system and records it for
            later steps, e.g. by generating system-dependent header files
            for inclusion in C source files and preprocessed Haskell
            source files.  (Clearly this won't work for Windows without
            MSYS or Cygwin: other ideas are needed.)</p></li><li class="listitem"><p>If the package root directory contains a file called
            <em class="replaceable"><code>package</code></em><code class="literal">.buildinfo</code>
            after the configuration step, subsequent steps will read it
            to obtain additional settings for build information fields
            (see <a class="xref" href="authors.html#buildinfo" title="3.1.4. Build information">Section 3.1.4, &#8220;Build information&#8221;</a>), to be merged with the
            ones given in the <code class="literal">.cabal</code> file.
            In particular, this file may be generated by the
            <code class="filename">configure</code> script mentioned above,
            allowing these settings to vary depending on the build
            environment.</p><p>The build information file should have the following
            structure:</p><pre class="programlisting">
<em class="replaceable"><code>buildinfo</code></em>

executable: <em class="replaceable"><code>name</code></em>
<em class="replaceable"><code>buildinfo</code></em>

executable: <em class="replaceable"><code>name</code></em>
<em class="replaceable"><code>buildinfo</code></em>

...</pre><p>where each <em class="replaceable"><code>buildinfo</code></em> consists
            of settings of fields listed in <a class="xref" href="authors.html#buildinfo" title="3.1.4. Build information">Section 3.1.4, &#8220;Build information&#8221;</a>.
            The first one (if present) relates to the library, while each
            of the others relate to the named executable.  (The names
            must match the package description, but you don't have to
            have entries for all of them.)</p></li></ol></div><p>Neither of these files is required.  If they are absent, this
        setup script is equivalent to <code class="literal">defaultMain</code>.</p><div class="example"><a name="autoconf-example"></a><p class="title"><b>Example 6. Using autoconf</b></p><div class="example-contents"><p>(This example is for people familiar with the <a class="ulink" href="http://www.gnu.org/software/autoconf/" target="_top"><span class="command"><strong>autoconf</strong></span></a>
          tools.)</p><p>In the X11 package, the file <code class="filename">configure.ac</code>
          contains:</p><pre class="programlisting">
AC_INIT([Haskell X11 package], [1.1], [libraries@haskell.org], [X11])

# Safety check: Ensure that we are in the correct source directory.
AC_CONFIG_SRCDIR([X11.cabal])

# Header file to place defines in
AC_CONFIG_HEADERS([include/HsX11Config.h])

# Check for X11 include paths and libraries
AC_PATH_XTRA
AC_TRY_CPP([#include &lt;X11/Xlib.h&gt;],,[no_x=yes])

# Build the package if we found X11 stuff
if test "$no_x" = yes
then BUILD_PACKAGE_BOOL=False
else BUILD_PACKAGE_BOOL=True
fi
AC_SUBST([BUILD_PACKAGE_BOOL])

AC_CONFIG_FILES([X11.buildinfo])
AC_OUTPUT</pre><p>Then the setup script will run the
          <code class="literal">configure</code> script, which checks for the
          presence of the X11 libraries and substitutes for variables
          in the file <code class="filename">X11.buildinfo.in</code>:</p><pre class="programlisting">
buildable: @BUILD_PACKAGE_BOOL@
cc-options: @X_CFLAGS@
ld-options: @X_LIBS@</pre><p>This generates a file <code class="filename">X11.buildinfo</code>
          supplying the parameters needed by later stages:</p><pre class="programlisting">
buildable: True
cc-options:  -I/usr/X11R6/include
ld-options:  -L/usr/X11R6/lib</pre><p>The <code class="filename">configure</code> script also generates
          a header file <code class="filename">include/HsX11Config.h</code>
          containing C preprocessor defines recording the results of
          various tests.  This file may be included by C source files
          and preprocessed Haskell source files in the package.</p></div></div><br class="example-break"><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Packages using these features will also need to list
          additional files such as <code class="filename">configure</code>,
          templates for <code class="literal">.buildinfo</code> files, files named
          only in <code class="literal">.buildinfo</code> files, header files and
          so on in the <code class="literal">extra-source-files</code> field,
          to ensure that they are included in source distributions.
          They should also list files and directories generated by
          <span class="command"><strong>configure</strong></span> in the
          <code class="literal">extra-tmp-files</code> field to ensure that they
          are removed by <span class="command"><strong>setup clean</strong></span>.</p></div></div><div class="sect2" title="3.4. Conditional compilation"><div class="titlepage"><div><div><h3 class="title"><a name="cpp"></a>3.4. Conditional compilation</h3></div></div></div><p>Sometimes you want to write code that works with more than
      one version of a dependency.  You can specify a range of
        versions for the depenency in
      the <code class="literal">build-depends</code>, but how do you then write
        the code that can use different versions of the API?</p><p>Haskell lets you preprocess your code using the C
        preprocessor (either the real C preprocessor, or
        <code class="literal">cpphs</code>).  To enable this,
        add <code class="literal">extensions: CPP</code> to your package
        description.  When using CPP, Cabal provides some pre-defined
        macros to let you test the version of dependent packages; for
        example, suppose your package works with either version 3 or
        version 4 of the <code class="literal">base</code> package, you could
        select the available version in your Haskell modules like
        this:</p><pre class="programlisting">
#if MIN_VERSION_base(4,0,0)
... code that works with base-4 ...
#else
... code that works with base-3 ...
#endif
</pre><p>In general, Cabal supplies a
  macro <code class="literal">MIN_VERSION_<em class="replaceable"><code>package</code></em>(A,B,C)</code>
  for each package depended on via <code class="literal">build-depends</code>.
  This macro is true if the actual version of the package in use is
  greater than or equal to <code class="literal">A.B.C</code> (using the
  conventional ordering on version numbers, which is lexicographic on
  the sequence, but numeric on each component, so for example 1.2.0 is
  greater than 1.0.3).</p><p>Cabal places the definitions of these macros into an
        automatically-generated header file, which is included when
        preprocessing Haskell source code by passing options to the C
        preprocessor.</p></div><div class="sect2" title="3.5. More complex packages"><div class="titlepage"><div><div><h3 class="title"><a name="complex-packages"></a>3.5. More complex packages</h3></div></div></div><p>For packages that don't fit the simple schemes described above,
        you have a few options:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>You can customize the simple build infrastructure
            using <em class="firstterm">hooks</em>.  These allow you to
            perform additional actions before and after each command is
            run, and also to specify additional preprocessors.  See
            <code class="literal">UserHooks</code> in <a class="ulink" href="../libraries/Cabal/Distribution-Simple.html" target="_top">Distribution.Simple</a> for the details,
            but note that this interface is experimental, and likely to
            change in future releases.</p></li><li class="listitem"><p>You could delegate all the work to <span class="command"><strong>make</strong></span>,
            though this is unlikely to be very portable.
            Cabal supports this with the <code class="literal">build-type</code>
            <code class="literal">Make</code> and a trivial setup library <a class="ulink" href="../libraries/Cabal/Distribution-Make.html" target="_top">Distribution.Make</a>,
            which simply parses the command line arguments and invokes
            <span class="command"><strong>make</strong></span>.  Here <code class="filename">Setup.hs</code>
            looks like</p><pre class="programlisting">
import Distribution.Make
main = defaultMain</pre><p>The root directory of the package should contain
            a <code class="filename">configure</code> script, and, after
            that has run, a <code class="filename">Makefile</code> with a
            default target that builds the package, plus targets
            <code class="literal">install</code>, <code class="literal">register</code>,
            <code class="literal">unregister</code>, <code class="literal">clean</code>,
            <code class="literal">dist</code> and <code class="literal">docs</code>.
            Some options to commands are passed through as follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>The <code class="option">--with-hc-pkg</code>,
                <code class="option">--prefix</code>, <code class="option">--bindir</code>,
                <code class="option">--libdir</code>, <code class="option">--datadir</code>
                and <code class="option">--libexecdir</code> options to the
                <code class="literal">configure</code> command are passed on to
                the <code class="filename">configure</code> script.
                In addition the value of the <code class="option">--with-compiler</code>
                option is passed in a <code class="option">--with-hc</code> option and
                all options specified with <code class="option">--configure-option</code>=
                are passed on.</p></li><li class="listitem"><p>the <code class="literal">--destdir</code> option to the
                <code class="literal">copy</code> command becomes a setting of a
                <code class="literal">destdir</code> variable on the invocation of
                <code class="literal">make copy</code>.  The supplied
                <code class="literal">Makefile</code> should provide a
                <code class="literal">copy</code> target, which will probably
                look like this:
</p><pre class="programlisting">
copy :
        $(MAKE) install prefix=$(destdir)/$(prefix) \
                        bindir=$(destdir)/$(bindir) \
                        libdir=$(destdir)/$(libdir) \
                        datadir=$(destdir)/$(datadir) \
                        libexecdir=$(destdir)/$(libexecdir)</pre><p>
</p></li></ul></div></li><li class="listitem"><p>You can write your own setup script conforming to the
            interface of <a class="xref" href="builders.html" title="4. Building and installing a package">Section 4, &#8220;Building and installing a package&#8221;</a>, possibly using
            the Cabal library for part of the work.  One option is to
            copy the source of <code class="literal">Distribution.Simple</code>,
            and alter it for your needs.  Good luck.</p></li></ul></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="packages.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="builders.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2. Packages </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4. Building and installing a package</td></tr></table></div></body></html>
